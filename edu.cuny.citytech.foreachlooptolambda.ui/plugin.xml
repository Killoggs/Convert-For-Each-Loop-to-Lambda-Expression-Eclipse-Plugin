<?xml version="1.0" encoding="utf-8"?>
<?eclipse version="3.4"?>
<plugin>
  <extension point="org.eclipse.ltk.core.refactoring.refactoringContributions">

    <contribution class="edu.cuny.citytech.foreachlooptolambda.ui.contributions.ForeachLoopToLambdaRefactoringContribution"
    id="org.eclipse.advance.forloop.to.lambda.contribution" />
  </extension>
  <extension point="org.eclipse.ui.commands">
    <command categoryId="org.eclipse.jdt.ui.category.refactoring"
    description="%AdvanceForLoopToLambdaDescription"
    id="org.eclipse.advance.forloop.to.lambda.command"
    name="AdvanceForLoopToLambda"/> 
  </extension>
  
  <extension point="org.eclipse.ui.handlers">
    <handler class="edu.cuny.citytech.foreachlooptolambda.ui.handlers.ForeachLoopToLambdaHandler"
    commandId="org.eclipse.advance.forloop.to.lambda.command">

       <activeWhen> 
	      <with 
	            variable="selection">
	         <or> 
		         <iterate
	                ifEmpty="false"
	                operator="or"> 
		            <instanceof 
		                  value="org.eclipse.jdt.core.IField"> 
		            </instanceof> 
		         </iterate> 
		         <iterate
	                ifEmpty="false"
	                operator="or"> 
		            <instanceof 
		                  value="org.eclipse.jdt.core.IType"> 
		            </instanceof> 
		         </iterate>
		         <iterate
	                ifEmpty="false"
	                operator="or"> 
		            <instanceof 
		                  value="org.eclipse.jdt.core.ICompilationUnit"> 
		            </instanceof> 
		         </iterate>
		         <iterate
	                ifEmpty="false"
	                operator="or"> 
		            <instanceof 
		                  value="org.eclipse.jdt.core.IPackageFragment"> 
		            </instanceof> 
		         </iterate>
		         
		         <iterate
	                ifEmpty="false"
	                operator="or"> 
		            <instanceof 
		                  value="org.eclipse.jdt.core.IPackageFragmentRoot"> 
		            </instanceof> 
		         </iterate>
		         <iterate
	                ifEmpty="false"
	                operator="or"> 
		            <instanceof 
		                  value="org.eclipse.jdt.core.IJavaProject"> 
		            </instanceof> 
		         </iterate>
	         </or>
	      </with> 
        </activeWhen> 
        
    </handler>
  </extension>
  <extension point="org.eclipse.ui.menus">
    <!-- [rk] Doesn't seem to be working -->
    <menuContribution locationURI="menu:org.eclipse.jdt.ui.refactoring.menu?after=additions">

      <command commandId="org.eclipse.advance.forloop.to.lambda.command"
      mnemonic="S"
      id="org.eclipse.advance.forloop.to.lambda.menus.command">

        <visibleWhen checkEnabled="true"></visibleWhen>
      </command>
    </menuContribution>
    <menuContribution locationURI="popup:org.eclipse.jdt.ui.refactoring.menu?after=additions">

      <command commandId="org.eclipse.advance.forloop.to.lambda.command"
      style="push">
        <visibleWhen checkEnabled="true"></visibleWhen>
      </command>
    </menuContribution>
  </extension>
  <!-- [rk] This is deprecated #2. -->
  <!-- [bm] we need to use actionSets for the Refactoring main menu as o.e.ui.menus is not capable of adding commands to actionsets -->
  
  </plugin>
